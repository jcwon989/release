<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë™í˜¸íšŒ ì†Œì‹ì§€ ë·°ì–´ (JSON ê¸°ë°˜)</title>
  <style>
    :root { color-scheme: light dark; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; }
    header { position: sticky; top:0; z-index:10; backdrop-filter: blur(6px); background: color-mix(in oklab, Canvas, CanvasText 6%/10%); border-bottom: 1px solid color-mix(in oklab, CanvasText 25%, transparent); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 14px 16px; }
    h1 { font-size:18px; margin:0; }.viewer { display:grid; gap:14px; padding: 16px; }
.stage { display:grid; place-items:center; border:1px solid color-mix(in oklab, CanvasText 20%, transparent); border-radius:14px; padding:10px; background: color-mix(in oklab, Canvas, CanvasText 3%/8%); min-height: 420px; }
.stage img { max-width: 100%; max-height: 70vh; height:auto; border-radius: 10px; display:block; }
.caption { text-align:center; font-size:12px; opacity:.8; margin-top:6px; }

.list { display:grid; gap:10px; }
.item { display:grid; grid-template-columns: 120px 1fr auto; gap:12px; align-items:center; padding:10px; border:1px solid color-mix(in oklab, CanvasText 20%, transparent); border-radius:12px; background: color-mix(in oklab, Canvas, CanvasText 2%/6%); cursor:pointer; }
.thumb { width:120px; height:76px; border-radius:10px; overflow:hidden; border:1px solid color-mix(in oklab, CanvasText 18%, transparent); }
.thumb img { width:100%; height:100%; object-fit:cover; display:block; }
.meta { display:flex; flex-direction:column; gap:4px; }
.title { font-size:14px; font-weight:600; line-height:1.2; }
.sub { font-size:12px; opacity:.7; }
.openbtn { padding:6px 10px; border-radius:10px; border:1px solid color-mix(in oklab, CanvasText 25%, transparent); background: Field; color: FieldText; }

.empty { text-align:center; padding: 40px 0; opacity:.7; }
.footer { text-align:center; padding: 16px; font-size:12px; opacity:.7; }

/* Lightbox (ì „ì²´ ë³´ê¸°) */
.lightbox { position: fixed; inset: 0; display: none; place-items: center; background: color-mix(in oklab, black 70%, transparent); }
.lightbox.open { display: grid; }
.lightbox img { max-width: 95vw; max-height: 85vh; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.5); }
.close { position: fixed; top: 12px; right: 12px; background: #000; color:#fff; border:none; border-radius:10px; padding:8px 10px; opacity:.75; cursor:pointer; }

  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ë™í˜¸íšŒ ì†Œì‹ì§€ ë·°ì–´ (JSON ê¸°ë°˜ ëª©ë¡ â†’ ì „ì²´ ì´ë¯¸ì§€)</h1>
    </div>
  </header>  <main class="wrap viewer">
    <div class="stage" id="stage" hidden>
      <img id="mainImg" alt="ì„ íƒëœ ì†Œì‹ì§€" />
      <div id="caption" class="caption"></div>
    </div><div id="empty" class="empty">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
<div id="list" class="list" hidden></div>

  </main>  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="close" aria-label="ë‹«ê¸°">ë‹«ê¸° âœ•</button>
    <img id="lightImg" alt="ì „ì²´ ë³´ê¸°" />
  </div>  <div class="footer">images/ í´ë”ì˜ JSONë“¤ì„ ì½ì–´ <code>created_at</code> ì—­ìˆœìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê³ , í´ë¦­ ì‹œ ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ì „ì²´ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>  <script>
    // ğŸ”§ ë ˆí¬ ì„¤ì •: ë³¸ì¸ ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
    const CONFIG = {
      owner: "your-username",   // GitHub ì‚¬ìš©ì/ì¡°ì§ëª…
      repo: "your-repo",        // ë ˆí¬ ì´ë¦„
      branch: "main",           // main ë˜ëŠ” gh-pages ë“±
      imageDir: "images",       // JSONì´ ë“¤ì–´ìˆëŠ” í´ë”(ì›ë³¸ ì´ë¯¸ì§€ë„ ì´ í´ë”ì— ìˆë‹¤ê³  ê°€ì •)
      thumbDir: "images/thumbnails", // ì¸ë„¤ì¼ í´ë” (thumb_*.ext)
      cacheMinutes: 10
    };

    const $ = (s) => document.querySelector(s);
    const listEl = $('#list');
    const empty = $('#empty');
    const stage = $('#stage');
    const mainImg = $('#mainImg');
    const caption = $('#caption');

    const lb = { el: $('#lightbox'), img: $('#lightImg') };
    document.querySelector('.close').addEventListener('click', () => closeLightbox());
    lb.el.addEventListener('click', (e) => { if (e.target === lb.el) closeLightbox(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });

    function openLightbox(src){ lb.img.src = src; lb.el.classList.add('open'); lb.el.setAttribute('aria-hidden','false'); }
    function closeLightbox(){ lb.el.classList.remove('open'); lb.el.setAttribute('aria-hidden','true'); lb.img.src = ''; }

    // Helpers
    const apiDir = (dir) => `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${encodeURIComponent(dir)}?ref=${CONFIG.branch}`;
    const rawUrl = (path) => `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${path}`;

    async function fetchJsonFiles(){
      const res = await fetch(apiDir(CONFIG.imageDir), { headers: { 'Accept': 'application/vnd.github+json' }});
      if (!res.ok) throw new Error('ë””ë ‰í† ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      const data = await res.json();
      const jsons = data.filter(x => x.type === 'file' && /\.json$/i.test(x.name));
      // ê° JSONì˜ download_urlë¡œ ì›ë³¸ JSONì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      const entries = await Promise.all(jsons.map(async (f)=>{
        try {
          const jr = await fetch(f.download_url, { cache: 'no-store' });
          if (!jr.ok) return null;
          const j = await jr.json();
          // JSON ìŠ¤í‚¤ë§ˆ: article_title, newspaper_name, date_str, article_content, image_filename, created_at
          const thumbName = j.image_filename; // thumb_ ì ‘ë‘ì–´ í¬í•¨ëœ ì¸ë„¤ì¼ íŒŒì¼ëª…
          const fullName = (thumbName || '').replace(/^thumb_/i, '');
          return {
            ...j,
            _json_name: f.name,
            thumb_url: rawUrl(`${CONFIG.thumbDir}/${thumbName}`),
            full_url: rawUrl(`${CONFIG.imageDir}/${fullName}`)
          };
        } catch { return null; }
      }));
      return entries.filter(Boolean);
    }

    function parseCreatedAt(str) {
      if (!str) return new Date(0);
      // ê¸°ëŒ€ í˜•ì‹: YYYYMMDD_HHMMSS
      const m = /^(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})$/.exec(str);
      if (!m) return new Date(0);
      const [_, y, mo, d, h, mi, s] = m;
      return new Date(
        parseInt(y, 10),
        parseInt(mo, 10) - 1,
        parseInt(d, 10),
        parseInt(h, 10),
        parseInt(mi, 10),
        parseInt(s, 10)
      );
    }
    
    function sortByCreatedAtDesc(arr) {
      return [...arr].sort((a, b) => {
        const da = parseCreatedAt(a.created_at || a.date_str);
        const db = parseCreatedAt(b.created_at || b.date_str);
        return db - da; // ìµœì‹ ìˆœ
      });
    }

    function saveCache(items){
      const key = `gh-news-json::${CONFIG.owner}/${CONFIG.repo}/${CONFIG.imageDir}`;
      localStorage.setItem(key, JSON.stringify({ at: Date.now(), items }));
    }
    function loadCache(){
      const key = `gh-news-json::${CONFIG.owner}/${CONFIG.repo}/${CONFIG.imageDir}`;
      const raw = localStorage.getItem(key);
      if (!raw) return null;
      try {
        const obj = JSON.parse(raw);
        if ((Date.now() - obj.at) < CONFIG.cacheMinutes*60*1000) return obj.items;
      } catch {}
      return null;
    }

    function renderList(items){
      listEl.innerHTML = '';
      if (!items.length){ empty.hidden = false; empty.textContent = 'í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'; listEl.hidden = true; return; }
      empty.hidden = true; listEl.hidden = false;

      const frag = document.createDocumentFragment();
      items.forEach((it)=>{
        const row = document.createElement('div');
        row.className = 'item';
        row.innerHTML = `
          <div class="thumb"><img loading="lazy" decoding="async" src="${it.thumb_url}" alt="${it.article_title || it._json_name}"></div>
          <div class="meta">
            <div class="title">${escapeHtml(it.article_title || '(ì œëª© ì—†ìŒ)')}</div>
            <div class="sub">${escapeHtml(it.newspaper_name || '')} Â· ${escapeHtml(it.date_str || '')}</div>
          </div>
          <button class="openbtn" type="button">ë³´ê¸°</button>
        `;
        row.addEventListener('click', (e)=>{
          if (e.target.closest('.openbtn') || e.currentTarget === row){
            showStage(it);
          }
        });
        frag.appendChild(row);
      });
      listEl.appendChild(frag);
    }

    function showStage(it){
      stage.hidden = false;
      mainImg.src = it.full_url;
      mainImg.alt = it.article_title || '';
      caption.textContent = it.article_title || '';
      // ì „ì²´ ë³´ê¸°(í´ë¦­ ì‹œ ë¼ì´íŠ¸ë°•ìŠ¤)
      mainImg.onclick = () => openLightbox(it.full_url);
    }

    function escapeHtml(s){
      return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    async function boot(){
      empty.hidden = false; empty.textContent = 'ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
      const cached = loadCache();
      if (cached){ renderList(cached); return; }
      try {
        const raw = await fetchJsonFiles();
        const items = sortByCreatedAtDesc(raw);
        saveCache(items);
        renderList(items);
      } catch(e){
        empty.hidden = false; empty.textContent = e.message || 'ë¡œë”© ì‹¤íŒ¨';
      }
    }

    boot();
  </script></body>
</html>
