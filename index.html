<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOVATO TIMES (ë…¸ë°”í†  ì†Œì‹ì§€)</title>
  <!-- Open Graph -->
  <meta property="og:title" content="Novato Times" />
  <meta property="og:description" content="ë…¸ë°”í†  ì†Œì‹" />
  <meta property="og:image" content="https://raw.githubusercontent.com/jcwon989/release/main/ChatGPT%20Image%202025%EB%85%84%207%EC%9B%94%2021%EC%9D%BC%20%EC%98%A4%ED%9B%84%2004_17_55.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://jcwon989.github.io/release/" />
  <style>
    :root { color-scheme: light dark; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; }
    header { position: sticky; top:0; z-index:10; backdrop-filter: blur(6px); background: color-mix(in oklab, Canvas, CanvasText 6%/10%); border-bottom: 1px solid color-mix(in oklab, CanvasText 25%, transparent); }
    
    .wrap { max-width: 700px; margin: 0 auto; padding: 14px 16px; }
    header h1 {
      font-size: 32px;                   /* ë” í¬ê²Œ */
      font-weight: 700;                  /* êµµê²Œ */
      text-align: center;                /* ê°€ìš´ë° ì •ë ¬ */
      font-family: "Times New Roman", Georgia, serif; /* ì‹ ë¬¸ ëŠë‚Œ */
      letter-spacing: 2px;               /* ê¸€ì ê°„ê²© */

      text-transform: uppercase;         /* ëŒ€ë¬¸ì (ì›ì¹˜ ì•Šìœ¼ë©´ ì§€ì›Œë„ ë¨) */
      margin: 0;
    }


    .viewer { display:grid; gap:14px; padding: 16px; }
    .list { display:grid; gap:10px; }
    .item { display:grid; grid-template-columns: 120px 1fr auto; gap:12px; align-items:center; padding:10px; border:1px solid color-mix(in oklab, CanvasText 20%, transparent); border-radius:12px; background: color-mix(in oklab, Canvas, CanvasText 2%/6%); cursor:pointer; }
    .thumb { width:120px; height:76px; border-radius:10px; overflow:hidden; border:1px solid color-mix(in oklab, CanvasText 18%, transparent); }
    .thumb img { width:100%; height:100%; object-fit:cover; object-position: top; display:block; }
    .meta { display:flex; flex-direction:column; gap:4px; }
    .title { font-size:14px; font-weight:600; line-height:1.2; }
    .sub { font-size:12px; opacity:.7; }
    .openbtn { padding:6px 10px; border-radius:10px; border:1px solid color-mix(in oklab, CanvasText 25%, transparent); background: Field; color: FieldText; }

    .empty { text-align:center; padding: 40px 0; opacity:.7; }
    .footer { text-align:center; padding: 16px; font-size:12px; opacity:.7; }

    /* Lightbox (íŒì—…) */
    .lightbox { position: fixed; inset: 0; display: none; place-items: center; background: color-mix(in oklab, black 70%, transparent); z-index: 9999; }
    .lightbox.open { display: grid; }
    .lightbox .box { display:flex; flex-direction:column; align-items:center; gap:8px; padding: 8px; }
    .lightbox img { max-width: 95vw; max-height: 85vh; border-radius: 0px; box-shadow: 0 10px 30px rgba(0,0,0,.5); }
    .lightbox .meta { color:#fff; font-size:12px; opacity:.9; text-align:center; }
    .close { position: fixed; top: 12px; right: 12px; background: #000; color:#fff; border:none; border-radius:10px; padding:8px 10px; opacity:.75; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>NOVATO TIMES</h1>
    </div>
  </header>

  <main class="wrap viewer">
    <div id="empty" class="empty">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
    <div id="list" class="list" hidden></div>
  </main>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="close" aria-label="ë‹«ê¸°">ë‹«ê¸° âœ•</button>
    <div class="box">
      <img id="lightImg" alt="ì „ì²´ ë³´ê¸°" />
      <div id="lightMeta" class="meta"></div>
    </div>
  </div>

  <div class="footer">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        width="18" height="18"
        style="vertical-align: middle; margin-right:6px;">
      <circle cx="12" cy="12" r="10" fill="orange" stroke="black" stroke-width="2"/>
      <path d="M2,12 H22 M12,2 V22 M4,4 C20,20 20,4 4,20"
            stroke="black" stroke-width="2" fill="none"/>
    </svg>
    NOVATO TIMES â€” Voice of the Court, Chronicle of Our Game
</div>

  <script>
    // ğŸ”§ ë ˆí¬ ì„¤ì •: ë³¸ì¸ ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
    const CONFIG = {
      owner: "jcwon989",              // GitHub ì‚¬ìš©ì/ì¡°ì§ëª…
      repo: "release",                // ë ˆí¬ ì´ë¦„
      branch: "main",                 // main ë˜ëŠ” gh-pages ë“±
      imageDir: "images",             // JSONì´ ë“¤ì–´ìˆëŠ” í´ë”
      thumbDir: "images/thumbnails",  // ì¸ë„¤ì¼ í´ë” (thumb_*.ext)
      cacheMinutes: 10
    };

    const $ = (s) => document.querySelector(s);
    const listEl = $('#list');
    const empty = $('#empty');

    const lb = { el: $('#lightbox'), img: $('#lightImg'), meta: $('#lightMeta') };
    const closeBtn = document.querySelector('.close');

    // íŒì—… ì–´ë””ë“  í´ë¦­í•˜ë©´ ë‹«í˜ (ë²„íŠ¼ í¬í•¨)
    lb.el.addEventListener('click', closeLightbox);
    closeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); closeLightbox(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });

    function openLightbox(src, metaText){
      lb.img.src = src;
      lb.meta.textContent = metaText || '';
      lb.el.classList.add('open');
      lb.el.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeLightbox(){
      lb.el.classList.remove('open');
      lb.el.setAttribute('aria-hidden','true');
      lb.img.src = '';
      lb.meta.textContent = '';
      document.body.style.overflow = '';
    }

    // API ë””ë ‰í† ë¦¬ URL
    const apiDir = (dir) =>
      `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${encodeURIComponent(dir)}?ref=${CONFIG.branch}`;

    // âœ… ê²½ë¡œ ì„¸ê·¸ë¨¼íŠ¸ë³„ ì¸ì½”ë”©(í•œê¸€/ê³µë°± íŒŒì¼ëª… ëŒ€ì‘)
    function rawUrl(path) {
      const parts = String(path).split('/').map(seg => encodeURIComponent(seg));
      return `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${parts.join('/')}`;
    }

    // created_at ì˜ˆ: "20250826_160639"
    function parseCreatedAt(str) {
      if (!str) return new Date(0);
      const m = /^(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})$/.exec(str);
      if (!m) return new Date(0);
      const [_, y, mo, d, h, mi, s] = m;
      return new Date(+y, +mo - 1, +d, +h, +mi, +s);
    }
    function sortByCreatedAtDesc(arr) {
      return [...arr].sort((a, b) => {
        const da = parseCreatedAt(a.created_at || a.date_str);
        const db = parseCreatedAt(b.created_at || b.date_str);
        return db - da; // ìµœì‹ ìˆœ
      });
    }

    function saveCache(items){
      const key = `gh-news-json::${CONFIG.owner}/${CONFIG.repo}/${CONFIG.imageDir}`;
      localStorage.setItem(key, JSON.stringify({ at: Date.now(), items }));
    }
    function loadCache(){
      const key = `gh-news-json::${CONFIG.owner}/${CONFIG.repo}/${CONFIG.imageDir}`;
      const raw = localStorage.getItem(key);
      if (!raw) return null;
      try {
        const obj = JSON.parse(raw);
        if ((Date.now() - obj.at) < CONFIG.cacheMinutes*60*1000) return obj.items;
      } catch {}
      return null;
    }

    function escapeHtml(s){
      return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    async function fetchJsonFiles(){
      const res = await fetch(apiDir(CONFIG.imageDir), { headers: { 'Accept': 'application/vnd.github+json' }});
      if (!res.ok) throw new Error('ë””ë ‰í† ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      const data = await res.json();
      const jsons = data.filter(x => x.type === 'file' && /\.json$/i.test(x.name));

      const entries = await Promise.all(jsons.map(async (f)=>{
        try {
          const jr = await fetch(f.download_url, { cache: 'no-store' });
          if (!jr.ok) return null;
          const j = await jr.json();

          // JSONì˜ image_filename ì€ "ì›ë³¸ íŒŒì¼ëª…" (ì˜ˆ: "a.png")
          const baseName = (j.image_filename || "").trim();
          if (!baseName) return null;

          // ì¸ë„¤ì¼ íŒŒì¼ëª…ì€ í•­ìƒ "thumb_" ì ‘ë‘ì–´
          const thumbName = "thumb_" + baseName;

          // ê²½ë¡œ ë§Œë“¤ê¸°
          const thumbPath = `${CONFIG.thumbDir}/${thumbName}`;
          const fullPath  = `${CONFIG.imageDir}/${baseName}`;

          return {
            ...j,
            _json_name: f.name,
            thumb_url: rawUrl(thumbPath),
            full_url:  rawUrl(fullPath)
          };
        } catch { return null; }
      }));

      return entries.filter(Boolean);
    }

    function renderList(items){
      listEl.innerHTML = '';
      if (!items.length){
        empty.hidden = false;
        empty.textContent = 'í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
        listEl.hidden = true;
        return;
      }
      empty.hidden = true;
      listEl.hidden = false;

      const frag = document.createDocumentFragment();
      items.forEach((it)=>{
        const row = document.createElement('div');
        row.className = 'item';
        row.innerHTML = `
          <div class="thumb">
            <img loading="lazy" decoding="async" src="${it.thumb_url}" alt="${escapeHtml(it.article_title || it._json_name)}">
          </div>
          <div class="meta">
            <div class="title">${escapeHtml(it.article_title || '(ì œëª© ì—†ìŒ)')}</div>
            <div class="sub">${escapeHtml(it.newspaper_name || '')} Â· ${escapeHtml(it.date_str || '')}</div>
          </div>
          <button class="openbtn" type="button">ë³´ê¸°</button>
        `;

        // ì¸ë„¤ì¼ ë¡œë”© ì‹¤íŒ¨ ì‹œ ì›ë³¸ìœ¼ë¡œ í´ë°±
        const imgEl = row.querySelector('img');
        imgEl.addEventListener('error', () => { imgEl.src = it.full_url; }, { once: true });

        // ë²„íŠ¼ í´ë¦­ â†’ ê¸°ì¡´ ë¼ì´íŠ¸ë°•ìŠ¤(ì´ë¯¸ì§€ í™•ëŒ€)
        const btn = row.querySelector('.openbtn');
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          e.preventDefault();
          const metaText = [it.article_title, it.newspaper_name, it.date_str].filter(Boolean).join(' Â· ');
          openLightbox(it.full_url, metaText);
        });

        // ì¹´ë“œ(í–‰) í´ë¦­ â†’ article.htmlë¡œ ì´ë™(ì›¹ì‹ ë¬¸ ìƒì„¸)
        row.addEventListener('click', (e) => {
          if (!e.target.closest('.openbtn')) {
            const jsonName = it._json_name;
            if (!jsonName) return;
            window.location.href = `article.html?j=${encodeURIComponent(jsonName)}`;
          }
        });

        frag.appendChild(row);
      });
      listEl.appendChild(frag);
    }

    async function boot(){
      empty.hidden = false; empty.textContent = 'ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';

      const cached = loadCache();
      if (cached){
        renderList(cached);
        return;
      }
      try {
        const raw = await fetchJsonFiles();
        const items = sortByCreatedAtDesc(raw);
        saveCache(items);
        renderList(items);
      } catch(e){
        empty.hidden = false; empty.textContent = e.message || 'ë¡œë”© ì‹¤íŒ¨';
      }
    }

    boot();
  </script>
</body>
</html>